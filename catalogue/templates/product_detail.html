{% extends "base_catalogue.html" %}

{% load extras %}
{% load urls %}
{% load form_tags %}
{% load ratings %}

{% block title %}{{ product.name }}{% endblock %}

{% if breadcrumbs %}{% block root-category %}{{ breadcrumbs.0.slug }}{% endblock %}{% endif %}

{% block body %}
    <div class="breadcrumbs">
        <a href="{% go_to_category '' %}">All Products</a> >
        {% for crumb in breadcrumbs %}
            <a href="{% go_to_category crumb.slug %}">{{ crumb.name }}</a> >
        {% endfor %}
        {{ product.name }}
    </div>

    <div class="product-detail">
        <div class="visual">
            <img src="{{ STATIC_URL }}products/example.jpg" alt="Image of {{ product.name }}">
        </div>
        <div class="description">
            <h1>{{ product.name }}</h1>
            {% rating avg_rating %}
            {% if avg_rating %}
                ({{ reviews.count }} <a class="tabview" href="#reviews">review{{ reviews.count|pluralize:",s" }}</a>)
            {% else %}
                <a href="{% url product_review product.slug %}">(be the first to write a review)</a>
            {% endif %}
            {% if product.quantity <= 0 %}
                <span class="out-of-stock">Out Of Stock</span>
            {% endif %}
            <div class="price">
                {% if product.sale_price %}
                    Was: <span class="old-price">{{ product.price|currency }}</span>
                    Now: <span class="sale-price">{{ product.sale_price|currency }}</span>
                {% else %}
                    <span class="price">{{ product.price|currency }}</span>
                {% endif %}
            </div>

            <div class="tabview">
                <ul class="tabrow">
                    <li id="description" class="tab selected"><a class="tabview" href="#description">Description</a></li>
                    <li id="specs" class="tab"><a class="tabview" href="#specs">Specifications</a></li>
                </ul>
                <div class="views">
                    <div id="description">
                        {% autoescape off %}
                            <div class="text">{{ product.long_description }}</div>
                        {% endautoescape %}
                    </div>
                    <div id="specs" class="hide-initially">
                        TODO
                    </div>
                </div>
            </div>

            <div class="add-to-cart">
                {% form_errors form %}
                {% if product.quantity > 0 %}
                    <form method="post" action="{% url catalogue_product product.slug %}" class="add-to-cart">
                        {% csrf_token %}
                        {% field_label_tag form.quantity %}{% aria_required_field form.quantity %}
                        {{ form.product_slug }}
                        <button type="submit" name="submit" class="action">Add to Cart</button>
                    </form>
                {% endif %}
            </div>
        </div>
    </div>

    <div id="feedback" class="tabview">
        <ul class="tabrow">
            <li class="tab selected" id="reviews"><a class="tabview" href="#reviews">Reviews ({{ reviews.count }})</a></li>
            <li class="tab" id="qa"><a class="tabview" href="#qa">Q & A</a></li>
        </ul>
        <div class="views">
            <div id="reviews">{% include "_reviews.html" %}</div>
            <div class="hide-initially" id="qa">{% include "_questions.html" %}</div>
        </div>
    </div>
{% endblock %}