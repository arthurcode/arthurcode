{% extends 'base_hd_ft.html' %}
{% load lazysignup_tags %}
{% load cart_tags %}
{% load cache %}

{% block header %}
    <div id="topbar">
        {% block topbar %}
            <img class="flag" src="{{ STATIC_URL }}icons/canada_flag_32.png">
            <span class="canadian">Proudly Canadian</span>
            <span class="contact">1-800-664-9741</span>
            {% block account_links %}
                {% cache 1000 account request.user.username %}
                    <a class="wishlists" href="{% url account_wishlists %}">my wish lists</a>
                    <a class="account" href="{% url account_personal %}">my account</a>
                    {% if user.is_authenticated and not user|is_lazy_user %}
                        <a class="logout" href="{% url logout %}?next={% url home %}">log out</a>
                        <span class="welcome">Welcome, {% firstof user.public_name user.first_name user.email %}</span>
                    {% else %}
                        <a class="login" href="{% url login_or_create_account %}">log in</a>
                    {% endif %}
                {% endcache %}
            {% endblock %}
        {% endblock %}
    </div>

    {% block banner %}
        <a href="{% url home %}">
        <img class="logo" src="{{ STATIC_URL }}icons/green_tree_icon.jpg">
        <span class="sitename">The Toy Tree</span>
        </a>
    {% endblock %}

    {% block navigation %}
        <ul id="primary-navigation">
            <li class="products"><a href="{% url catalogue_category '' %}">Shop</a></li>
            <li class="help"><a>FAQ</a></li>
            <li class="contact"><a href="{% url contact %}">Contact</a></li>
            <li class="blog"><a href="{% url index %}">Blog</a></li>
        </ul>
    {% endblock %}

    <div class="header-bar">
        {% block cart-summary %}
            <div class="cart-summary">
                {% cart_summary request %}
            </div>
        {% endblock %}
        {% block search-bar %}
            <form id="search" class="no-help" method="post" action="{% url product_search %}">
                {% csrf_token %}
                <input type="hidden" name="from" id="id_from" value={{ request.path|urlencode }}>
                <fieldset>
                    <div class="field text">
                        <label class="hidden" for="id_q">Search Text</label>
                        <input type="text" name="q" id="id_q" required aria-required="true"><button type="submit" name="search" class="action">Search</button>
                    </div>
                </fieldset>
            </form>
        {% endblock %}
        {% block extra-utilities %}{% endblock %}
        {% block secondary-nav-title%}{% endblock %}
    </div>
    {% block secondary-navigation %}{% endblock %}
{% endblock %}

{% block footer %}
    <a href="{% url home %}">home</a>
    <a href="{% url about %}">about us</a>
    <span class='copyright'>copyright &copy 2013 www.thetoytree.com</span>
    {% if user.is_staff %}<a href="{% url admin:index %}">admin</a>{% endif %}
{% endblock %}

{% block javascript %}
    {{ block.super }}
    <script type="text/javascript">
        YUI().use('node', 'event', 'custom', 'panel', function(Y) {
            // monkey with the positioning of the error messages in form fields.  As it is they are great for screen
            // readers but difficult to style
            Y.all('.field.error').each(function(field) {
                Y.Custom.positionFieldError(field);
            });

            // add some simple client-side validation to the search bar(s)
            Y.all("form#search button").each(function (searchButton) {
                searchButton.on("click", function(e) {
                    var form = searchButton.ancestor("form#search");
                    var searchBox = form.one("input#id_q");
                    var searchText = searchBox.get("value").trim();
                    var error = null;

                    if (searchText.length <= 1) {
                        // invalid search query
                        e.preventDefault();
                        if (searchText.length == 0) {
                            error = "Enter a search word or phrase";
                        } else {
                            error = "Type at least 2 characters in the search box";
                        }
                    } else if (searchText.length > 50) {
                        error = "Too many characters.  Max is 50, you entered " + searchText.length
                    }
                    if (error) {
                        e.preventDefault();
                        var field = searchBox.ancestor(".field");
                        Y.Custom.setFieldError(field, error, true); // error as a popup
                    }
                });
            });
        });
    </script>
{% endblock %}