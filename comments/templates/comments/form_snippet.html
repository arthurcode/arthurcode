{% load comment i18n %}
{% load blog_extras %}

<form class="comment" action="{% comment_form_target %}" method="post">{% csrf_token %}
    {% if next %}<div><input type="hidden" name="next" value="{{ next }}" /></div>{% endif %}

    {#Render the hidden fields#}
    {% for field in form %}
        {% if field.is_hidden %}
            <div>{{ field }}</div>
        {% endif %}
    {% endfor %}

    {# render the honeypot #}
    <div class="field text" style="display:none;">
        {% field_label_tag form.honeypot %}{% aria_required_field form.honeypot %}
    </div>

    {# render the visible fields #}
    {% if not user.is_authenticated %}
        {# render name and email fields #}
        {% with form.name as field %}{% include 'comments/field_snippet.html' %}{% endwith %}
        {% with form.email as field %}{% include 'comments/field_snippet.html' %}{% endwith %}
        {% with form.email_on_reply as field %}{% include 'comments/field_snippet.html' %}{% endwith %}
        {% with form.comment as field %}{% include 'comments/field_snippet.html' %}{% endwith %}
    {% else %}
        {% with form.comment as field %}{% include 'comments/field_snippet.html' %}{% endwith %}
        {% with form.email_on_reply as field %}{% include 'comments/field_snippet.html' %}{% endwith %}
    {% endif %}

    {% comment %} The parent field was added to support threaded comments {% endcomment %}
    {% if node.id %}
        <input type="hidden" name="parent" id="parent_id" value="{{ node.id }}"/>
    {% endif %}
    <div class="controls">
        <button type="submit" name="post" class="submit-post yui3-button">Post</button>
        <button type="submit" name="preview" class="submit-preview yui3-button">Preview</button>
    </div>
</form>