{% extends 'base_checkout.html' %}

{% load form_tags %}
{% load extras %}

{% block order_summary %}{% endblock %}

{% block forms %}
    <div class="review-order">
        <h2 class="title-bar">Review Your Order</h2>
        <div class="contact">
            <h3>Contact Information <a href="{% url checkout_contact %}">(edit)</a></h3>
            {{ order.first_name }} {{ order.last_name }} <br>
            {{ order.email }} <br>
            {{ order.phone }}
        </div>
        <div class="shipping">
            <h3>Shipping Address <a href="{% url checkout_shipping %}">(edit)</a></h3>
            {% with order.shipping_address as address %}{% include "_address.html" %}{% endwith %}
        </div>
        <div class="billing">
            <h3>Billing Address <a href="{% url checkout_billing %}">(edit)</a></h3>
            {% with order.billing_address as address %}{% include "_address.html" %}{% endwith %}
        </div>
        <div class="items">
            <table class="shopping-cart">
                <caption class="hidden">Order Breakdown</caption>
                <thead class="title-bar">
                <tr>
                    <th scope="col">Product</th>
                    <th class="right" scope="col">Item Price</th>
                    <th class="right" scope="col">Quantity</th>
                    <th class="right" scope="col">Item Total</th>
                </tr>
                </thead>
                <tfoot>
                <tr>
                    <th class="right" colspan="3">
                        Subtotal:
                    </th>
                    <th class="right">
                        {{ order.merchandise_total|currency }}
                    </th>
                </tr>
                <tr>
                    <th class="right" colspan="3">
                        + Shipping:
                    </th>
                    <th class="right">
                        {{ order.shipping_charge|currency }}
                    </th>
                </tr>
                {% for tax_name, tax_rate, total in order.tax_breakdown %}
                    <tr>
                        <th class="right" colspan="3">
                            + {{ tax_name }} ({{ tax_rate }}%):
                        </th>
                        <th class="right">
                            {{ total|currency }}
                        </th>
                    </tr>
                {% endfor %}
                <tr>
                    <th class="right" colspan="3">
                        Total:
                    </th>
                    <th class="right">
                        {{ order.total|currency }}
                    </th>
                </tr>
                </tfoot>
                <tbody>
                {% if order.items %}
                    {% for item in order.items %}
                        <tr>
                            <td>
                                <a href="{{ item.get_absolute_url }}"><img src="{{ STATIC_URL }}products/thumbnails/example.jpg" alt="{{ item.product.name }}"/></a>
                                <a href="{{ item.get_absolute_url }}" class="cart">{{ item.product.name }}</a>
                            </td>
                            <td class="right">
                                {{ item.price|currency }}
                            </td>
                            <td class="right">
                                {{ item.quantity }}
                            </td>
                            <td class="right">
                                {{ item.total|currency }}
                            </td>
                        </tr>
                    {% endfor %}
                {% else %}
                    <tr>
                        <td class="left" colspan="4">
                            There are no items on this order
                        </td>
                    </tr>
                {% endif %}
                </tbody>
            </table>
        </div>
    </div>

    <div class='payment-info'>
        <h2 class="title-bar">Enter Payment Info</h2>
        {% form_errors form %}
        <form method="post" action="" class="stacked">
            {% csrf_token %}
            {% comment %}Hidden form fields{% endcomment %}
            {{ form.total }}
                <p>
                {% field form.first_name %}
                {% field form.last_name %}
                </p>
                {% field form.card_type %}
                <p>
                {% field form.card_number %}
                {% field form.cvv %}
                </p>
                <fieldset>
                    <legend>
                        Expiry Date
                    </legend>
                    {% field form.expire_month %}
                    {% field form.expire_year %}
                </fieldset>
            <div class="controls">
                <button class="action" name="submit">Submit Order</button>
            </div>
        </form>
    </div>
{% endblock %}